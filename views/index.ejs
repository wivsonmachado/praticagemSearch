<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Praticagem Search</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
        integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
    <script src="/js/findVessel.js"></script>
</head>
<body>
    <div class="container">
        <div class="d-flex justify-content-center mt-5 my-3">
            <img src="/img/logo_4@0,75x.png" class="img-fluid">
        </div>
        <div class="d-flex justify-content-center"> 
            <div class="form-group col-8 col-sm-8 col-md-8 col-xl-6 p-0">
                <input type="text" class="form-control" id="navio"
                    placeholder="Nome do navio">
            </div>
        </div>
        <div class="form-group d-flex justify-content-center">
            <button class="btn btn-danger col-3 col-sm-2 col-md-2 col-xl-2" onclick="vessel()"
                type="submit">Search</button>
        </div>
        <div class="h5 d-flex justify-content-center">
            <div id="res"></div>
        </div>
    </div>
    <script>
        var input = document.getElementById('navio')
        input.addEventListener("keyup", function (event) {
            if (event.key === 'Enter') {
                vessel()
            }
        })
    </script>

    <!-- Dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"
        crossorigin="anonymous"></script>
    <!-- Bootstrap 4 Autocomplete -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-4-autocomplete/dist/bootstrap-4-autocomplete.min.js"
        crossorigin="anonymous"></script>


    <script>

        let url = 'https://shielded-springs-02765.herokuapp.com/json'
        let arrFull
        const nameVesselArray = fetch(url).then((res) => res.json())
            .then(json => {
                arrFull = json.map(e => {
                    return { "nomeNavio": e.nomeNavio }
                })
                let arrFiltered = new Set()
                const newArrFull = arrFull.filter(i => {
                    const isPresentInSet = arrFiltered.has(i.nomeNavio)
                    arrFiltered.add(i.nomeNavio)
                    return !isPresentInSet
                })
                return newArrFull
            }).catch(err => console.log(err))

            function firedSearch(){
                vessel()
            }

        const proAll = () => {
            return Promise.all([nameVesselArray]).then(res => {
                //console.log(res[0])
                $('#navio').autocomplete({
                    source: res[0],
                    highlightClass: 'text-danger',
                    label: "nomeNavio",
                    treshold: 1,
                    onSelectItem: firedSearch
                });
            })
        }

        proAll()

    </script>

</body>

</html>